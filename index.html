<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet åœ°åœ– - é¢¨æ ¼åˆ‡æ› + GPS å®šä½</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map { height: 800px; width: 100%; }
        .leaflet-control-custom {
            background: white;
            padding: 5px;
            cursor: pointer;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>

<h2>åŠ æ‹¿å®¶å®¶è¨ªåœ°åœ–</h2>
<div id="map"></div>

<script>
    // åˆå§‹åŒ–åœ°åœ–
    var map = L.map('map').setView([23.00116136899162, 121.13137331027815], 130);

    // **ä¸åŒçš„åœ°åœ–é¢¨æ ¼ Tile Layers**
    var streetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap è²¢ç»è€…'
    });

    var grayscaleMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: 'Â© CartoDB (Grayscale)'
    });

    var darkModeMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'Â© CartoDB (Dark Mode)'
    });

    var satelliteMap = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap (Satellite)'
    });

    // **é è¨­é¡¯ç¤ºè¡—é“åœ°åœ–**
    streetMap.addTo(map);

    // **åœ°åœ–åˆ‡æ›æ§åˆ¶**
    var baseMaps = {
        "è¡—é“åœ– (Street Map)": streetMap,
        "ç°éšé¢¨æ ¼ (Grayscale)": grayscaleMap,
        "å¤œé–“æ¨¡å¼ (Dark Mode)": darkModeMap,
        "è¡›æ˜Ÿåœ– (Satellite)": satelliteMap
    };

    L.control.layers(baseMaps).addTo(map);

    // **GPS å®šä½åŠŸèƒ½**
    function locateUser() {
        if (!navigator.geolocation) {
            alert("ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´ GPS å®šä½åŠŸèƒ½");
            return;
        }

        navigator.geolocation.watchPosition(function(position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            var accuracy = position.coords.accuracy;

            // **ç§»é™¤èˆŠçš„æ¨™è¨˜**
            if (typeof userMarker !== "undefined") {
                map.removeLayer(userMarker);
                map.removeLayer(userCircle);
            }

            // **é¡¯ç¤ºä½¿ç”¨è€…ä½ç½®**
            userMarker = L.marker([lat, lon]).addTo(map)
                .bindPopup("<b>æ‚¨çš„ä½ç½®</b><br>ç·¯åº¦: " + lat + "<br>ç¶“åº¦: " + lon).openPopup();

            // **é¡¯ç¤ºæº–ç¢ºç¯„åœ**
            userCircle = L.circle([lat, lon], { radius: accuracy, color: "blue", fillOpacity: 0.3 }).addTo(map);

            // **ç§»å‹•åœ°åœ–åˆ°ä½¿ç”¨è€…ä½ç½®**
            map.setView([lat, lon], 15);

        }, function() {
            alert("ç„¡æ³•ç²å–æ‚¨çš„ä½ç½®ï¼Œè«‹ç¢ºèªå·²é–‹å•Ÿ GPS");
        });
    }

    // **GPS å®šä½æŒ‰éˆ•**
    var locateButton = L.control({ position: "topright" });

    locateButton.onAdd = function () {
        var div = L.DomUtil.create("div", "leaflet-bar leaflet-control leaflet-control-custom");
        div.innerHTML = '<button onclick="locateUser()">ğŸ“ å®šä½</button>';
        return div;
    };

    locateButton.addTo(map);


    // **æ·»åŠ æ¨™è¨˜ (Marker)**
    var marker = L.marker([23.00116136899162, 121.13137331027815]).addTo(map)
        .bindPopup("<b>åŠ æ‹¿åœ‹å°</b><br>é€™æ˜¯æˆ‘å€‘çš„åŸºåœ°ã€‚")
        .openPopup();
</script>

</body>
</html>
